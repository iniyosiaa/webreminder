<!DOCTYPE html>
<html lang="id">
  <head>
    <link rel="stylesheet" href="style.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XI TEI 1 Website</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
      @media (max-width: 600px) {
        .search-box {
          width: 100%;
          justify-content: space-between;
        }

        .search-input {
          width: 70%; /* biar gak terlalu panjang di mobile */
          max-width: none;
          transition: all 0.25s ease;
        }

        .search-input:focus {
          width: 80%; /* pas fokus, nambah dikit aja */
        }

        .close-search {
          margin-left: 6px;
          font-size: 18px;
        }
      }

      .close-search {
        cursor: pointer;
        font-size: 16px;
        color: #777;
        transition: color 0.2s;
      }
    </style>
  </head>

  <body>
    <header>
      <div class="logo">XI TEI 1</div>
      <div class="header-icons">
        <div class="search-icon" id="searchIcon" onclick="toggleSearch(true)">ğŸ”</div>

        <div class="search-box" id="searchBox">
          <input type="text" class="search-input" id="search" placeholder="Cari tugas..." onkeyup="cariTugas()" />
          <span class="close-search" onclick="toggleSearch(false)">âœ–</span>
        </div>

        <div class="user-icon" id="userIcon" onclick="toggleLogin()">ğŸ‘¤</div>
        <div class="theme-toggle" id="themeToggle" onclick="toggleTheme()">ğŸŒ™</div>
      </div>
    </header>

    <main>
<!-- ğŸŒ¿ EVENT SEKOLAH -->
<section class="event-section" id="eventSection">
  <h2 class="event-title">ğŸŒ¿ Event Sekolah</h2>

  <!-- Loading state -->
  <div class="event-loading" id="eventLoading">
    <div class="event-loading-bar shimmer"></div>
    <div class="event-loading-bar shimmer short"></div>
    <div class="event-loading-bar shimmer long"></div>
  </div>

  <!-- Card event -->
  <div class="event-card" id="eventCard" style="display: none;">
    <div class="event-header" onclick="toggleEvent()">
 <div class="event-title-row">
    <h3>Hari Pahlawan 10 November</h3>
    <span class="event-date">ğŸ—“ï¸ 10 November 2025</span>
  </div>
  <span class="toggle-arrow" id="eventArrow">â–¼</span>
</div>

    <div class="event-body" id="eventBody">
      <p>
        "Mengenang pahlawan, menginspirasi generasi bangsa".
      </p>
      <p>HS Akan Mengadakan Lomba Sebagai Berikut:</p>
      <ul>
        <li>Baju pejuang terbaik</li>
        <li>Drama Pantomim</li>
        <li>Cerdas Cermat</li>
        <li>Pesan Rahasia Pahlawan</li>
        <li>Puzzle</li>
      </ul>

      <p>
        Ada Upacara Bendera Sebelum Kegiatan Lomba Berlangsung
        <br />Jangan Lupa Membawa Atribut Lengkap Saat Upacara !!
        <br /><br />
        Info selengkapnya bisa ditanyakan di grup kelas, Thankyou..
      </p>
    </div>
  </div>
</section>

  </div>
</section>

  </div>
</section>
      <div class="form-container" id="formContainer">
        <div class="welcome-admin" id="welcomeAdmin">
          <p>Selamat datang, Admin! Kelola tugas sekarang.</p>
          <button class="btn-small logout-btn" onclick="logout()">Logout</button>
        </div>
        <h2>Tambah Tugas Baru</h2>

        <select id="tipe" required>
          <option value="">Pilih Tipe Tugas</option>
          <option value="Tugas">Tugas</option>
          <option value="Praktik">Praktik</option>
          <option value="Penilaian Harian (PH)">Penilaian Harian (PH)</option>
        </select>

        <select id="mapel" required onchange="autoIsiGuru()">
          <option value="">Pilih Mapel</option>
          <option value="PRE">Penerapan Sistem</option>
          <option value="SKE">Sistem Kendali</option>
          <option value="Embeded">Embeded</option>
          <option value="Bahasa Indonesia">Bahasa Indonesia</option>
          <option value="Bahasa jawa">Bahasa Jawa</option>
          <option value="Bahasa Inggris">Bahasa Inggris</option>
          <option value="Mandarin">Mandarin</option>
          <option value="PAK">PAK</option>
          <option value="BK">BK</option>
          <option value="Olahraga">Olahraga</option>
          <option value="Coding">Coding</option>
          <option value="Fisika">Fisika</option>
          <option value="Matematika">Matematika</option>
        </select>

        <input type="text" id="guru" placeholder="Guru otomatis" readonly />
        <input type="text" id="judul" placeholder="Judul Tugas (misal: Latihan Bab 5)" required />
        <textarea id="deskripsi" placeholder="Deskripsi tugas..." rows="3"></textarea>
        <input type="date" id="deadline" required />
        <button onclick="tambahTugas()">Tambah Tugas</button>
      </div>
      <div class="task-list" id="taskList">
        <p class="loading-card">Loading tugas...</p>
      </div>
  </div>
</section>

    </main>

    <div id="loginModal" class="modal">
      <div class="login-container">
        <span class="close" onclick="closeLogin()">&times;</span>
        <h2>Login Admin</h2>
        <input type="password" id="password" placeholder="Masukkan password" />
        <button onclick="login()">Masuk</button>
      </div>
      <!-- Modal Detail Tugas -->
      <div id="detailModal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeDetail()">&times;</span>
          <h2 id="detailJudul"></h2>
          <p><strong>Mapel:</strong> <span id="detailMapel"></span></p>
          <p><strong>Guru:</strong> <span id="detailGuru"></span></p>
          <p><strong>Tipe:</strong> <span id="detailTipe"></span></p>
          <p><strong>Deadline:</strong> <span id="detailDeadline"></span></p>
          <hr />
          <p id="detailDeskripsi" style="margin-top: 10px"></p>
        </div>
      </div>
    </div>

    <script>
      // Firebase Config (isi punyamu)
      const firebaseConfig = {
        apiKey: "AIzaSy...your-api-key...",
        authDomain: "tugas-8a094.firebaseapp.com",
        databaseURL: "https://tugas-8a094-default-rtdb.firebaseio.com/",
        projectId: "tugas-8a094",
        storageBucket: "tugas-8a094.appspot.com",
        messagingSenderId: "123...",
        appId: "1:123...:web:abc...",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      const tugasRef = db.ref("tugas");

      const ADMIN_PASSWORD = "admin123";
      let tugasList = [];
      let isAdmin = false;
      let editMode = false;
      let editingIndex = null;

      // Map otomatis guru per mapel
      const guruMap = {
        PRE: "Pak Yohanes",
        SKE: "Pak Daniel",
        Embeded: "Pak Sugeng",
        "Bahasa Indonesia": "Pak Amin",
        "Bahasa Jawa": "Pak Stefanus",
        "Bahasa Inggris": "Mr. Slamet",
        Mandarin: "Virda è€å¸ˆ",
        PAK: "Bu Ica",
        BK: "Bu Meti",
        Olahraga: "Pak Alex",
        Coding: "Pak Franky",
        Fisika: "Pak Arif",
        Matematika: "Bu Dinda",
      };

      function autoIsiGuru() {
        const mapel = document.getElementById("mapel").value;
        document.getElementById("guru").value = guruMap[mapel] || "";
      }

      tugasRef.on("value", (snapshot) => {
        const data = snapshot.val();
        tugasList = data ? Object.entries(data).map(([id, tugas]) => ({ ...tugas, id })) : [];
        renderTugas(!isAdmin);
      });

      function toggleLogin() {
        if (!isAdmin) document.getElementById("loginModal").style.display = "block";
      }
      function closeLogin() {
        document.getElementById("loginModal").style.display = "none";
      }

      function login() {
        const pass = document.getElementById("password").value;
        if (pass === ADMIN_PASSWORD) {
          closeLogin();
          isAdmin = true;
          document.getElementById("formContainer").style.display = "block";
          renderTugas(false);
        } else alert("Password salah!");
      }
      function logout() {
        isAdmin = false;
        document.getElementById("formContainer").style.display = "none";
        renderTugas(true);
      }

      function tambahTugas() {
        if (!isAdmin) return alert("Hanya admin bisa tambah tugas!");
        const mapel = document.getElementById("mapel").value;
        const guru = document.getElementById("guru").value;
        const tipe = document.getElementById("tipe").value;
        const judul = document.getElementById("judul").value;
        const deskripsi = document.getElementById("deskripsi").value;
        const deadline = document.getElementById("deadline").value;

        if (!mapel || !guru || !tipe || !judul || !deadline) return alert("Isi semua field!");

        const data = { mapel, guru, tipe, judul, deskripsi, deadline };

        if (editMode && editingIndex) {
          tugasRef.child(editingIndex).update(data);
          editMode = false;
          editingIndex = null;
        } else tugasRef.push(data);

        document.getElementById("mapel").value = "";
        document.getElementById("guru").value = "";
        document.getElementById("judul").value = "";
        document.getElementById("deskripsi").value = "";
        document.getElementById("deadline").value = "";
        document.getElementById("tipe").value = "";
      }

      function editTugas(id) {
        if (!isAdmin) return;
        const tugas = tugasList.find((t) => t.id === id);
        if (!tugas) return;
        editingIndex = id;
        document.getElementById("mapel").value = tugas.mapel;
        document.getElementById("guru").value = tugas.guru;
        document.getElementById("judul").value = tugas.judul;
        document.getElementById("deskripsi").value = tugas.deskripsi;
        document.getElementById("deadline").value = tugas.deadline;
        editMode = true;
      }

      function hapusTugas(id) {
        if (!isAdmin) return;
        if (confirm("Yakin hapus tugas ini?")) tugasRef.child(id).remove();
      }

      function renderTugas(guestMode = true, list = tugasList) {
        const taskList = document.getElementById("taskList");
        if (!list.length) {
          taskList.innerHTML = '<p class="no-tasks">Belum ada tugas. Admin bisa menambahkannya!</p>';
          return;
        }
        list.sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
        taskList.innerHTML = list
          .map((t) => {
            const overdue = new Date(t.deadline) < new Date();
            return `
            <div class="task-card">
              <div class="task-info">
                <p class="task-meta">
                  <p class="task-type">${t.tipe}</p>
                  <span class="mapel-badge">${t.mapel} â€” ${t.guru}</span>
                </p>
                <h3>${t.judul}</h3>
                <p class="task-meta">${t.deskripsi || ""}</p>
                <p class="task-meta ${overdue ? "overdue" : ""}">
                  Deadline: ${new Date(t.deadline).toLocaleDateString("id-ID")}
                  ${overdue ? "(Terlambat!)" : ""}
                </p>
              </div>
              ${
                !guestMode
                  ? `<div>
                      <button class="btn-small edit-btn" onclick="editTugas('${t.id}')">Edit</button>
                      <button class="btn-small delete-btn" onclick="hapusTugas('${t.id}')">Hapus</button>
                    </div>`
                  : ""
              }
            </div>`;
          })
          .join("");
      }

      function cariTugas() {
        const query = document.getElementById("search").value.toLowerCase();
        const filtered = tugasList.filter((tugas) => tugas.judul.toLowerCase().includes(query) || tugas.guru.toLowerCase().includes(query) || tugas.mapel.toLowerCase().includes(query));
        renderTugas(!isAdmin, filtered);
      } // Close modal when clicking outside document.getElementById("loginModal").addEventListener("click", function (event) { if (event.target === this) { closeLogin(); } });
      function toggleSearch(open) {
        const searchBox = document.getElementById("searchBox");
        const searchIcon = document.getElementById("searchIcon");

        if (open) {
          // buka mode search
          searchIcon.style.display = "none";
          searchBox.classList.add("show");
          document.getElementById("search").focus();
        } else {
          // tutup mode search
          searchBox.classList.remove("show");
          setTimeout(() => {
            searchIcon.style.display = "flex";
          }, 200); // delay biar animasi keburu selesai
          document.getElementById("search").value = "";
          cariTugas(); // reset hasil search
        }
      }
      function toggleTheme() {
        const body = document.body;
        body.classList.toggle("dark");

        // Ganti icon
        const icon = document.getElementById("themeToggle");
        icon.textContent = body.classList.contains("dark") ? "â˜€ï¸" : "ğŸŒ™";

        // Simpan preferensi user
        localStorage.setItem("theme", body.classList.contains("dark") ? "dark" : "light");
      }

      // Cek preferensi sebelumnya pas load
      window.onload = () => {
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
          document.body.classList.add("dark");
          document.getElementById("themeToggle").textContent = "â˜€ï¸";
        }
      };
// ğŸŒ¿ Setelah loading selesai, tampilkan event dengan efek
window.addEventListener("DOMContentLoaded", () => {
  const eventLoading = document.getElementById("eventLoading");
  const eventCard = document.getElementById("eventCard");

  setTimeout(() => {
    eventLoading.style.display = "none";
    eventCard.style.display = "block";
  }, 2000);
});

// ğŸ”½ Toggle event dropdown
function toggleEvent() {
  const card = document.getElementById("eventCard");
  card.classList.toggle("open");
}

    </script>
  </body>
</html>
